<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Supabase-Enabled Debate Chart</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        /* CSS remains the same as the previous version */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            line-height: 1.6;
            display: flex;
            justify-content: center;
            background-color: #f0f0f0;
        }
        .container {
            width: 66%;
            max-width: 1000px;
            background-color: white;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        /* ... (rest of the CSS remains unchanged) ... */
    </style>
</head>
<body>
    <div class="container">
        <div class="search">
            <input type="text" id="searchInput" placeholder="Search arguments...">
            <button onclick="searchArguments()">Search</button>
        </div>
        <div class="add-card">
            <h3>Add New Argument</h3>
            <input type="text" id="newTitle" placeholder="Title">
            <textarea id="newText" placeholder="Main argument"></textarea>
            <textarea id="newSupport" placeholder="Supporting information"></textarea>
            <select id="argumentSide">
                <option value="against">Against</option>
                <option value="for">For</option>
            </select>
            <button onclick="addNewCard()">Add Argument</button>
        </div>
        <div class="debate-container">
            <div class="column" id="againstColumn">
                <h2>Against</h2>
            </div>
            <div class="column" id="forColumn">
                <h2>For</h2>
            </div>
        </div>
    </div>
    <div id="contextMenu" class="context-menu">
        <button onclick="editCard(this)">Edit</button>
    </div>

    <script>
        // Initialize Supabase client
        const supabaseUrl = 'https://nhzsthjygbacyybgmxlb.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5oenN0aGp5Z2JhY3l5YmdteGxiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MjQ0NTAwMDUsImV4cCI6MjA0MDAyNjAwNX0.7GF7L33ZNfo8cRkL8cf6nMXyITx8I8O2R9J-Gj8grtM';
        const supabase = supabase.createClient(supabaseUrl, supabaseKey);

        let debateData = { against: [], for: [] };

        async function loadDebateData() {
            const { data, error } = await supabase
                .from('arguments')
                .select('*');

            if (error) {
                console.error('Error loading data:', error);
                return;
            }

            debateData = { against: [], for: [] };
            data.forEach(arg => {
                debateData[arg.side].push(arg);
            });

            renderArguments();
        }

        async function saveArgument(argument) {
            const { data, error } = await supabase
                .from('arguments')
                .upsert(argument);

            if (error) {
                console.error('Error saving argument:', error);
            }
        }

        async function deleteArgument(id) {
            const { error } = await supabase
                .from('arguments')
                .delete()
                .match({ id: id });

            if (error) {
                console.error('Error deleting argument:', error);
            }
        }

        function renderArguments() {
            const againstColumn = document.getElementById('againstColumn');
            const forColumn = document.getElementById('forColumn');
            
            againstColumn.innerHTML = '<h2>Against</h2>';
            forColumn.innerHTML = '<h2>For</h2>';
            
            debateData.against.forEach(arg => {
                const card = createCard(arg, 'against');
                againstColumn.appendChild(card);
            });
            
            debateData.for.forEach(arg => {
                const card = createCard(arg, 'for');
                forColumn.appendChild(card);
            });
        }

        function createCard(arg, side) {
            const card = document.createElement('div');
            card.className = 'card';
            card.dataset.id = arg.id;
            card.dataset.side = side;
            card.innerHTML = `
                <h3>${arg.title}</h3>
                <p>${arg.text}</p>
                <div class="support">${arg.support}</div>
            `;
            card.addEventListener('contextmenu', showContextMenu);
            return card;
        }

        function showContextMenu(e) {
            e.preventDefault();
            const contextMenu = document.getElementById('contextMenu');
            contextMenu.style.display = 'block';
            contextMenu.style.left = `${e.pageX}px`;
            contextMenu.style.top = `${e.pageY}px`;
            contextMenu.dataset.cardId = e.currentTarget.dataset.id;
            contextMenu.dataset.side = e.currentTarget.dataset.side;
        }

        document.addEventListener('click', function() {
            document.getElementById('contextMenu').style.display = 'none';
        });

        function editCard(button) {
            const contextMenu = button.parentElement;
            const cardId = contextMenu.dataset.cardId;
            const side = contextMenu.dataset.side;
            const card = document.querySelector(`.card[data-id="${cardId}"][data-side="${side}"]`);
            const argument = debateData[side].find(arg => arg.id == cardId);

            card.innerHTML = `
                <input type="text" value="${argument.title}" id="editTitle${cardId}">
                <textarea id="editText${cardId}">${argument.text}</textarea>
                <textarea id="editSupport${cardId}">${argument.support}</textarea>
                <button onclick="saveEdit('${side}', ${cardId})">Save</button>
                <button class="cancel" onclick="cancelEdit('${side}', ${cardId})">Cancel</button>
            `;
        }

        async function saveEdit(side, id) {
            const argument = debateData[side].find(arg => arg.id == id);
            argument.title = document.getElementById(`editTitle${id}`).value;
            argument.text = document.getElementById(`editText${id}`).value;
            argument.support = document.getElementById(`editSupport${id}`).value;

            await saveArgument(argument);
            await loadDebateData();
        }

        function cancelEdit(side, id) {
            renderArguments();
        }

        function searchArguments() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const filteredData = {
                against: debateData.against.filter(arg => 
                    arg.title.toLowerCase().includes(searchTerm) ||
                    arg.text.toLowerCase().includes(searchTerm) ||
                    arg.support.toLowerCase().includes(searchTerm)
                ),
                for: debateData.for.filter(arg => 
                    arg.title.toLowerCase().includes(searchTerm) ||
                    arg.text.toLowerCase().includes(searchTerm) ||
                    arg.support.toLowerCase().includes(searchTerm)
                )
            };
            
            const againstColumn = document.getElementById('againstColumn');
            const forColumn = document.getElementById('forColumn');
            
            againstColumn.innerHTML = '<h2>Against</h2>';
            forColumn.innerHTML = '<h2>For</h2>';
            
            filteredData.against.forEach(arg => {
                const card = createCard(arg, 'against');
                againstColumn.appendChild(card);
            });
            
            filteredData.for.forEach(arg => {
                const card = createCard(arg, 'for');
                forColumn.appendChild(card);
            });
        }

        async function addNewCard() {
            const title = document.getElementById('newTitle').value;
            const text = document.getElementById('newText').value;
            const support = document.getElementById('newSupport').value;
            const side = document.getElementById('argumentSide').value;
            
            if (title && text) {
                const newCard = {
                    title: title,
                    text: text,
                    support: support,
                    side: side
                };
                
                await saveArgument(newCard);
                await loadDebateData();
                
                // Clear input fields
                document.getElementById('newTitle').value = '';
                document.getElementById('newText').value = '';
                document.getElementById('newSupport').value = '';
            } else {
                alert('Please enter at least a title and main argument.');
            }
        }

        // Initial load
        loadDebateData();
    </script>
</body>
</html>
